{"version":3,"file":"OppgaveHandlingerMenu-45c4c8bf.js","sources":["../../src/behandlingskoer/components/menu/MenuButton.tsx","../../src/behandlingskoer/components/menu/OppgaveHandlingerMenu.tsx"],"sourcesContent":["import React, { ReactNode, FunctionComponent } from 'react';\nimport { Detail } from '@navikt/ds-react';\n\nimport styles from './menuButton.module.css';\n\ninterface OwnProps {\n  onClick: () => void;\n  children: ReactNode;\n  ref?: any;\n}\n\n/**\n * MenuButton\n *\n * Presentasjonskomponent. Lager lenker i behandlingsmeny\n */\nconst MenuButton: FunctionComponent<OwnProps> = React.forwardRef(({ onClick, children }, ref: any) => (\n  <button ref={ref} className={styles.button} onClick={onClick} type=\"button\">\n    <Detail>{children}</Detail>\n  </button>\n));\n\nexport default MenuButton;\n","import React, { useEffect, FunctionComponent, MouseEvent, useState, useRef, useCallback } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { VerticalSpacer } from '@navikt/ft-ui-komponenter';\nimport { getDateAndTime } from '@navikt/ft-utils';\nimport { Oppgave, OppgaveReservasjonEndringDatoModal, FlyttReservasjonModal } from '@navikt/fp-los-felles';\n\nimport { restApiHooks, RestApiPathsKeys } from '../../../data/fplosSaksbehandlerRestApi';\nimport MenuButton from './MenuButton';\nimport OpphevReservasjonModal from './OpphevReservasjonModal';\nimport OppgaveReservasjonForlengetModal from './forleng/OppgaveReservasjonForlengetModal';\n\nimport styles from './oppgaveHandlingerMenu.module.css';\n\ntype Offset = {\n  top: number;\n  left: number;\n};\n\nconst getOffsetPositionStyle = (offset: Offset) =>\n  window.innerWidth > offset.left + 250\n    ? { left: `${42 + offset.left}px`, top: `${offset.top - 20}px` }\n    : { left: `${offset.left - 200}px`, top: `${offset.top + 38}px` };\n\nconst toggleEventListeners = (turnOnEventListeners: boolean, handleOutsideClick: (event: any) => void) => {\n  if (turnOnEventListeners) {\n    document.addEventListener('click', handleOutsideClick, false);\n    document.addEventListener('mousedown', handleOutsideClick, false);\n    document.addEventListener('keydown', handleOutsideClick, false);\n  } else {\n    document.removeEventListener('click', handleOutsideClick, false);\n    document.removeEventListener('mousedown', handleOutsideClick, false);\n    document.removeEventListener('keydown', handleOutsideClick, false);\n  }\n};\n\ninterface OwnProps {\n  toggleMenu: (valgtOppgave: Oppgave) => void;\n  offset: Offset;\n  oppgave: Oppgave;\n  imageNode: HTMLDivElement | null;\n  forlengOppgaveReservasjon: (oppgaveId: number) => Promise<string>;\n  hentReserverteOppgaver: (params: any, keepData: boolean) => void;\n}\n\nconst OppgaveHandlingerMenu: FunctionComponent<OwnProps> = ({\n  toggleMenu,\n  offset,\n  oppgave,\n  imageNode,\n  forlengOppgaveReservasjon,\n  hentReserverteOppgaver,\n}) => {\n  const [showOpphevReservasjonModal, setOpphevReservasjonModal] = useState(false);\n  const [showForlengetReservasjonModal, setForlengetReservasjonModal] = useState(false);\n  const [showReservasjonEndringDatoModal, setReservasjonEndringDatoModal] = useState(false);\n  const [showFlyttReservasjonModal, setFlyttReservasjonModal] = useState(false);\n\n  const menuButtonRef = useRef<HTMLButtonElement>();\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const handleOutsideClick = (event: MouseEvent<HTMLButtonElement>) => {\n    // ignore clicks on the component itself\n    const harKlikketMeny = divRef.current && divRef.current.contains(event.target as Node);\n    const harKlikketIkon = imageNode && imageNode.contains(event.target as Node);\n    if (harKlikketMeny || harKlikketIkon) {\n      return;\n    }\n\n    toggleMenu(oppgave);\n  };\n\n  useEffect(() => {\n    toggleEventListeners(true, handleOutsideClick);\n    if (menuButtonRef && menuButtonRef.current) {\n      menuButtonRef.current.focus();\n    }\n    return () => {\n      toggleEventListeners(false, handleOutsideClick);\n    };\n  }, []);\n\n  const showBegrunnelseModal = useCallback(() => {\n    toggleEventListeners(false, handleOutsideClick);\n    setOpphevReservasjonModal(true);\n  }, [handleOutsideClick]);\n\n  const closeBegrunnelseModal = useCallback(() => {\n    toggleMenu(oppgave);\n    toggleEventListeners(false, handleOutsideClick);\n    setOpphevReservasjonModal(false);\n  }, [toggleMenu, oppgave, handleOutsideClick]);\n\n  const showFlytteModal = useCallback(() => {\n    toggleEventListeners(false, handleOutsideClick);\n    setFlyttReservasjonModal(true);\n  }, [handleOutsideClick]);\n\n  const closeFlytteModal = useCallback(() => {\n    toggleMenu(oppgave);\n    toggleEventListeners(false, handleOutsideClick);\n    setFlyttReservasjonModal(false);\n  }, [toggleMenu, oppgave, handleOutsideClick]);\n\n  const closeForlengReservasjonModal = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      toggleMenu(oppgave);\n      handleOutsideClick(event);\n    },\n    [toggleMenu, oppgave, handleOutsideClick],\n  );\n\n  const forlengReserverasjon = useCallback(() => {\n    forlengOppgaveReservasjon(oppgave.id).then(() => {\n      toggleEventListeners(false, handleOutsideClick);\n      setForlengetReservasjonModal(true);\n    });\n  }, [forlengOppgaveReservasjon, oppgave, handleOutsideClick]);\n\n  const closeReservasjonEndringDatoModal = useCallback(\n    (event: MouseEvent<HTMLButtonElement>) => {\n      toggleMenu(oppgave);\n      handleOutsideClick(event);\n    },\n    [toggleMenu, oppgave, handleOutsideClick],\n  );\n\n  const showReservasjonEndringDato = useCallback(() => {\n    toggleEventListeners(false, handleOutsideClick);\n    setReservasjonEndringDatoModal(true);\n  }, [handleOutsideClick]);\n\n  const endreReserverasjonState = useCallback(() => {\n    toggleEventListeners(false, handleOutsideClick);\n    setForlengetReservasjonModal(true);\n  }, [handleOutsideClick]);\n\n  const toggleMeny = useCallback(() => {\n    toggleMenu(oppgave);\n  }, [toggleMenu, oppgave]);\n\n  const { startRequest: endreOppgavereservasjon } = restApiHooks.useRestApiRunner(\n    RestApiPathsKeys.ENDRE_OPPGAVERESERVASJON,\n  );\n\n  const { startRequest: flyttOppgavereservasjon } = restApiHooks.useRestApiRunner(RestApiPathsKeys.FLYTT_RESERVASJON);\n\n  const {\n    startRequest: hentSaksbehandler,\n    state: hentSaksbehandlerState,\n    data: saksbehandler,\n    resetRequestData: resetHentSaksbehandler,\n  } = restApiHooks.useRestApiRunner(RestApiPathsKeys.FLYTT_RESERVASJON_SAKSBEHANDLER_SOK);\n\n  const bTag = useCallback((...chunks: any) => <b>{chunks}</b>, []);\n\n  return (\n    <>\n      <div className={styles.containerMenu} style={getOffsetPositionStyle(offset)} ref={divRef}>\n        {oppgave.status.reservertTilTidspunkt && (\n          <FormattedMessage\n            id=\"OppgaveHandlingerMenu.ReservertTil\"\n            values={{\n              ...getDateAndTime(oppgave.status.reservertTilTidspunkt),\n              b: bTag,\n            }}\n          />\n        )}\n        <VerticalSpacer eightPx />\n        <MenuButton onClick={showBegrunnelseModal} ref={menuButtonRef}>\n          <FormattedMessage id=\"OppgaveHandlingerMenu.LeggTilbake\" values={{ br: <br /> }} />\n        </MenuButton>\n        <MenuButton onClick={forlengReserverasjon}>\n          <FormattedMessage id=\"OppgaveHandlingerMenu.ForlengReservasjon\" values={{ br: <br /> }} />\n        </MenuButton>\n\n        <MenuButton onClick={showReservasjonEndringDato}>\n          <FormattedMessage id=\"OppgaveHandlingerMenu.EndreReservasjon\" />\n        </MenuButton>\n        <MenuButton onClick={showFlytteModal}>\n          <FormattedMessage id=\"OppgaveHandlingerMenu.FlyttReservasjon\" values={{ br: <br /> }} />\n        </MenuButton>\n      </div>\n      {showOpphevReservasjonModal && (\n        <OpphevReservasjonModal\n          oppgave={oppgave}\n          showModal={showOpphevReservasjonModal}\n          cancel={closeBegrunnelseModal}\n          toggleMenu={toggleMeny}\n          hentReserverteOppgaver={hentReserverteOppgaver}\n        />\n      )}\n      {showReservasjonEndringDatoModal && (\n        <OppgaveReservasjonEndringDatoModal\n          showModal={showReservasjonEndringDatoModal}\n          closeModal={closeReservasjonEndringDatoModal}\n          reserverTilDefault={oppgave.status.reservertTilTidspunkt}\n          oppgaveId={oppgave.id}\n          hentReserverteOppgaver={hentReserverteOppgaver}\n          endreReserverasjonState={endreReserverasjonState}\n          endreOppgavereservasjon={endreOppgavereservasjon}\n        />\n      )}\n      {showForlengetReservasjonModal && (\n        <OppgaveReservasjonForlengetModal\n          oppgave={oppgave}\n          showModal={showForlengetReservasjonModal}\n          closeModal={closeForlengReservasjonModal}\n        />\n      )}\n      {showFlyttReservasjonModal && (\n        <FlyttReservasjonModal\n          oppgaveId={oppgave.id}\n          showModal={showFlyttReservasjonModal}\n          closeModal={closeFlytteModal}\n          toggleMenu={toggleMeny}\n          hentReserverteOppgaver={hentReserverteOppgaver}\n          flyttOppgavereservasjon={flyttOppgavereservasjon}\n          hentSaksbehandler={hentSaksbehandler}\n          hentSaksbehandlerState={hentSaksbehandlerState}\n          saksbehandler={saksbehandler}\n          resetHentSaksbehandler={resetHentSaksbehandler}\n        />\n      )}\n    </>\n  );\n};\n\nexport default OppgaveHandlingerMenu;\n"],"names":["MenuButton","React","onClick","children","ref","jsx","styles","Detail","getOffsetPositionStyle","offset","toggleEventListeners","turnOnEventListeners","handleOutsideClick","OppgaveHandlingerMenu","toggleMenu","oppgave","imageNode","forlengOppgaveReservasjon","hentReserverteOppgaver","showOpphevReservasjonModal","setOpphevReservasjonModal","useState","showForlengetReservasjonModal","setForlengetReservasjonModal","showReservasjonEndringDatoModal","setReservasjonEndringDatoModal","showFlyttReservasjonModal","setFlyttReservasjonModal","menuButtonRef","useRef","divRef","event","harKlikketMeny","harKlikketIkon","useEffect","showBegrunnelseModal","useCallback","closeBegrunnelseModal","showFlytteModal","closeFlytteModal","closeForlengReservasjonModal","forlengReserverasjon","closeReservasjonEndringDatoModal","showReservasjonEndringDato","endreReserverasjonState","toggleMeny","endreOppgavereservasjon","restApiHooks","RestApiPathsKeys","flyttOppgavereservasjon","hentSaksbehandler","hentSaksbehandlerState","saksbehandler","resetHentSaksbehandler","bTag","chunks","jsxs","Fragment","FormattedMessage","getDateAndTime","VerticalSpacer","OpphevReservasjonModal","OppgaveReservasjonEndringDatoModal","OppgaveReservasjonForlengetModal","FlyttReservasjonModal","OppgaveHandlingerMenu$1"],"mappings":"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"}