{"version":3,"file":"AndreYtelserPapirsoknadIndex.stories-6a0e74be.js","sources":["../../../kodeverk/src/arbeidType.ts","../../src/andreYtelserPanel/components/RenderAndreYtelserPerioderFieldArray.tsx","../../src/andreYtelserPanel/components/AndreYtelserPanel.tsx","../../src/andreYtelserPanel/AndreYtelserPapirsoknadIndex.tsx"],"sourcesContent":["const arbeidType = {\n  LONN_UNDER_UTDANNING: 'LØNN_UNDER_UTDANNING',\n  UTENLANDSK_ARBEIDSFORHOLD: 'UTENLANDSK_ARBEIDSFORHOLD',\n  FRILANSER: 'FRILANSER',\n  MILITÆR_ELLER_SIVILTJENESTE: 'MILITÆR_ELLER_SIVILTJENESTE',\n};\n\nexport default arbeidType;\n","import React, { FunctionComponent } from 'react';\nimport { useIntl } from 'react-intl';\nimport { UseFormGetValues, useFieldArray, useFormContext } from 'react-hook-form';\nimport { FlexColumn, FlexContainer, FlexRow, VerticalSpacer } from '@navikt/ft-ui-komponenter';\nimport { Datepicker, PeriodFieldArray } from '@navikt/ft-form-hooks';\nimport { required, hasValidDate, dateAfterOrEqual, dateBeforeOrEqual } from '@navikt/ft-form-validators';\n\nimport styles from './renderAndreYtelserPerioderFieldArray.module.css';\n\nexport const ANDRE_YTELSER_NAME_PREFIX = 'andreYtelser';\n\nexport const ANDRE_YTELSER_PERIODE_SUFFIX = 'PERIODER';\n\nexport type FormValues = {\n  periodeFom: string;\n  periodeTom: string;\n};\n\nconst getValue = (\n  getValues: UseFormGetValues<{ [ANDRE_YTELSER_NAME_PREFIX]: FormValues }>,\n  fieldName: string,\n  // @ts-ignore\n): string => getValues(fieldName);\n\ninterface OwnProps {\n  readOnly: boolean;\n  name: string;\n}\n\ninterface StaticFunctions {\n  transformValues: (\n    values: FormValues[],\n    ytelseType: string,\n  ) => {\n    ytelseType: string;\n    periodeFom: string;\n    periodeTom: string;\n  }[];\n}\n\n/**\n * RenderAndreYtelserPerioderFieldArray\n *\n * Viser inputfelter for fra og til dato for perioder for andre ytelser\n */\nconst RenderAndreYtelserPerioderFieldArray: FunctionComponent<OwnProps> & StaticFunctions = ({ readOnly, name }) => {\n  const intl = useIntl();\n\n  const {\n    getValues,\n    control,\n    trigger,\n    formState: { isSubmitted },\n  } = useFormContext<{ [ANDRE_YTELSER_NAME_PREFIX]: FormValues }>();\n  const { fields, remove, append } = useFieldArray({\n    control,\n    // @ts-ignore Usikker på korleis ein fiksar denne (Dynamisk name basert på verdiar fra backend)\n    name: `${ANDRE_YTELSER_NAME_PREFIX}.${name}`,\n  });\n\n  return (\n    <PeriodFieldArray\n      fields={fields}\n      bodyText={intl.formatMessage({ id: 'Registrering.FrilansOppdrag.FieldArray.NyPeriode' })}\n      readOnly={readOnly}\n      append={append}\n      remove={remove}\n    >\n      {(field, index, getRemoveButton) => {\n        const namePart1 = `${ANDRE_YTELSER_NAME_PREFIX}.${name}.${index}`;\n        return (\n          <div key={field.id}>\n            <div className={index !== fields.length - 1 ? styles.notLastRow : ''}>\n              <FlexContainer>\n                <FlexRow>\n                  <FlexColumn>\n                    <Datepicker\n                      name={`${namePart1}.periodeFom`}\n                      label={index === 0 ? intl.formatMessage({ id: 'Registrering.AndreYtelser.periodeFom' }) : ''}\n                      validate={[\n                        required,\n                        hasValidDate,\n                        () => {\n                          const fomVerdi = getValue(getValues, `${namePart1}.periodeFom`);\n                          const tomVerdi = getValue(getValues, `${namePart1}.periodeTom`);\n                          return tomVerdi && fomVerdi ? dateBeforeOrEqual(tomVerdi)(fomVerdi) : null;\n                        },\n                      ]}\n                      onChange={() => (isSubmitted ? trigger() : undefined)}\n                    />\n                  </FlexColumn>\n                  <FlexColumn>\n                    <Datepicker\n                      name={`${namePart1}.periodeTom`}\n                      label={index === 0 ? intl.formatMessage({ id: 'Registrering.AndreYtelser.periodeTom' }) : ''}\n                      validate={[\n                        required,\n                        hasValidDate,\n                        () => {\n                          const fomVerdi = getValue(getValues, `${namePart1}.periodeFom`);\n                          const tomVerdi = getValue(getValues, `${namePart1}.periodeTom`);\n                          return tomVerdi && fomVerdi ? dateAfterOrEqual(fomVerdi)(tomVerdi) : null;\n                        },\n                      ]}\n                      onChange={() => (isSubmitted ? trigger() : undefined)}\n                    />\n                  </FlexColumn>\n                  {getRemoveButton && <FlexColumn>{getRemoveButton()}</FlexColumn>}\n                </FlexRow>\n              </FlexContainer>\n            </div>\n            <VerticalSpacer sixteenPx />\n          </div>\n        );\n      }}\n    </PeriodFieldArray>\n  );\n};\n\nRenderAndreYtelserPerioderFieldArray.transformValues = (values: FormValues[], ytelseType: string): any =>\n  values.map(ytelsePeriode => ({\n    ytelseType,\n    periodeFom: ytelsePeriode.periodeFom,\n    periodeTom: ytelsePeriode.periodeTom,\n  }));\n\nexport default RenderAndreYtelserPerioderFieldArray;\n","import React, { FunctionComponent, useMemo } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport { Heading } from '@navikt/ds-react';\nimport { CheckboxField } from '@navikt/ft-form-hooks';\nimport { ArrowBox, BorderBox, VerticalSpacer } from '@navikt/ft-ui-komponenter';\nimport { AlleKodeverk, KodeverkMedNavn } from '@navikt/fp-types';\nimport { arbeidType, KodeverkType } from '@navikt/fp-kodeverk';\n\nimport { useFormContext } from 'react-hook-form';\nimport RenderAndreYtelserPerioderFieldArray, {\n  FormValues as PerioderFormValues,\n  ANDRE_YTELSER_PERIODE_SUFFIX,\n  ANDRE_YTELSER_NAME_PREFIX,\n} from './RenderAndreYtelserPerioderFieldArray';\n\nconst removeArbeidstyper = (\n  andreYtelser: KodeverkMedNavn[],\n  kunMiliterEllerSiviltjeneste?: boolean,\n): KodeverkMedNavn[] => {\n  if (kunMiliterEllerSiviltjeneste) {\n    return andreYtelser.filter(ay => ay.kode === arbeidType.MILITÆR_ELLER_SIVILTJENESTE);\n  }\n  return andreYtelser.filter(\n    ay =>\n      ay.kode !== arbeidType.UTENLANDSK_ARBEIDSFORHOLD &&\n      ay.kode !== arbeidType.FRILANSER &&\n      ay.kode !== arbeidType.LONN_UNDER_UTDANNING,\n  );\n};\n\nexport type FormValues = {\n  [ANDRE_YTELSER_NAME_PREFIX]?: {\n    [key: string]: PerioderFormValues[];\n  };\n};\n\ninterface OwnProps {\n  readOnly: boolean;\n  alleKodeverk: AlleKodeverk;\n  kunMiliterEllerSiviltjeneste?: boolean;\n}\n\ninterface StaticFunctions {\n  buildInitialValues: (andreYtelser: KodeverkMedNavn[]) => FormValues;\n  transformValues: (values: FormValues, andreYtelser: KodeverkMedNavn[]) => any;\n}\n\n/**\n * AndreYtelserPanel\n *\n * Komponenten vises som del av skjermbildet for registrering av papirsøknad dersom søknad gjelder foreldrepenger.\n */\nconst AndreYtelserPanel: FunctionComponent<OwnProps> & StaticFunctions = ({\n  readOnly,\n  kunMiliterEllerSiviltjeneste = false,\n  alleKodeverk,\n}) => {\n  const { watch } = useFormContext<{ [ANDRE_YTELSER_NAME_PREFIX]: FormValues }>();\n  const selectedYtelser = watch(ANDRE_YTELSER_NAME_PREFIX);\n\n  const andreYtelser = alleKodeverk[KodeverkType.ARBEID_TYPE];\n\n  const filtrerteArbeidstyper = useMemo(\n    () => removeArbeidstyper(andreYtelser, kunMiliterEllerSiviltjeneste),\n    [kunMiliterEllerSiviltjeneste],\n  );\n\n  return (\n    <BorderBox>\n      <Heading size=\"small\">\n        <FormattedMessage id=\"Registrering.AndreYtelser.Title\" />\n      </Heading>\n      <VerticalSpacer sixteenPx />\n      {filtrerteArbeidstyper.map(ay => {\n        const ytelseFieldName = `${ay.kode}_${ANDRE_YTELSER_PERIODE_SUFFIX}`;\n        return (\n          <React.Fragment key={ay.kode}>\n            <CheckboxField\n              key={ay.kode}\n              name={`${ANDRE_YTELSER_NAME_PREFIX}.${ay.kode}`}\n              label={ay.navn}\n              readOnly={readOnly}\n            />\n            {/* @ts-ignore TODO Er dette korrekt? Burde det vore selectedYtelser[ANDRE_YTELSER_NAME_PREFIX][ay.kode] */}\n            {selectedYtelser && selectedYtelser[ay.kode] && (\n              <>\n                <VerticalSpacer eightPx />\n                <ArrowBox>\n                  <RenderAndreYtelserPerioderFieldArray name={ytelseFieldName} readOnly={readOnly} />\n                </ArrowBox>\n              </>\n            )}\n          </React.Fragment>\n        );\n      })}\n    </BorderBox>\n  );\n};\n\nAndreYtelserPanel.buildInitialValues = (andreYtelser: KodeverkMedNavn[]): FormValues => {\n  const ytelseInitialValues = {} as Record<string, PerioderFormValues[]>;\n  removeArbeidstyper(andreYtelser).forEach(ay => {\n    const ytelsePeriodeFieldName = `${ay.kode}_${ANDRE_YTELSER_PERIODE_SUFFIX}`;\n    ytelseInitialValues[ytelsePeriodeFieldName] = [{} as PerioderFormValues];\n  });\n  return { [ANDRE_YTELSER_NAME_PREFIX]: ytelseInitialValues };\n};\n\nAndreYtelserPanel.transformValues = (values: FormValues, andreYtelser: KodeverkMedNavn[]): any => {\n  const ytelseValues = values[ANDRE_YTELSER_NAME_PREFIX];\n  const newValues = [] as {\n    ytelseType: string;\n    periodeFom: string;\n    periodeTom: string;\n  }[];\n\n  andreYtelser\n    .filter(ay => ytelseValues && ytelseValues[ay.kode])\n    .forEach(ay => {\n      const ytelsePerioderFieldName = `${ay.kode}_${ANDRE_YTELSER_PERIODE_SUFFIX}`;\n      const ytelsePerioder = ytelseValues ? ytelseValues[ytelsePerioderFieldName] : undefined;\n      if (ytelsePerioder) {\n        RenderAndreYtelserPerioderFieldArray.transformValues(ytelsePerioder, ay.kode).forEach(tv => newValues.push(tv));\n      }\n    });\n\n  return newValues;\n};\n\nexport default AndreYtelserPanel;\n","import React, { FunctionComponent } from 'react';\nimport { RawIntlProvider } from 'react-intl';\nimport { createIntl } from '@navikt/ft-utils';\nimport { AlleKodeverk, KodeverkMedNavn } from '@navikt/fp-types';\n\nimport AndreYtelserPanel, { FormValues } from './components/AndreYtelserPanel';\nimport messages from '../../i18n/nb_NO.json';\n\nconst intl = createIntl(messages);\n\ninterface OwnProps {\n  readOnly: boolean;\n  alleKodeverk: AlleKodeverk;\n  kunMiliterEllerSiviltjeneste?: boolean;\n}\n\ninterface StaticFunctions {\n  buildInitialValues: (andreYtelser: KodeverkMedNavn[]) => FormValues;\n  transformValues: (values: FormValues, andreYtelser: KodeverkMedNavn[]) => any;\n}\n\nconst AndreYtelserPapirsoknadIndex: FunctionComponent<OwnProps> & StaticFunctions = ({\n  readOnly,\n  alleKodeverk,\n  kunMiliterEllerSiviltjeneste,\n}) => (\n  <RawIntlProvider value={intl}>\n    <AndreYtelserPanel\n      readOnly={readOnly}\n      alleKodeverk={alleKodeverk}\n      kunMiliterEllerSiviltjeneste={kunMiliterEllerSiviltjeneste}\n    />\n  </RawIntlProvider>\n);\n\nAndreYtelserPapirsoknadIndex.buildInitialValues = andreYtelser => AndreYtelserPanel.buildInitialValues(andreYtelser);\n\nAndreYtelserPapirsoknadIndex.transformValues = (values, andreYtelser) =>\n  AndreYtelserPanel.transformValues(values, andreYtelser);\n\nexport default AndreYtelserPapirsoknadIndex;\n"],"names":["arbeidType","ANDRE_YTELSER_NAME_PREFIX","ANDRE_YTELSER_PERIODE_SUFFIX","getValue","getValues","fieldName","RenderAndreYtelserPerioderFieldArray","readOnly","name","intl","useIntl","control","trigger","isSubmitted","useFormContext","fields","remove","append","useFieldArray","jsx","PeriodFieldArray","field","index","getRemoveButton","namePart1","jsxs","styles","FlexContainer","FlexRow","FlexColumn","Datepicker","required","hasValidDate","fomVerdi","tomVerdi","dateBeforeOrEqual","dateAfterOrEqual","VerticalSpacer","values","ytelseType","ytelsePeriode","removeArbeidstyper","andreYtelser","kunMiliterEllerSiviltjeneste","ay","AndreYtelserPanel","alleKodeverk","watch","selectedYtelser","KodeverkType","filtrerteArbeidstyper","useMemo","BorderBox","Heading","FormattedMessage","ytelseFieldName","React","CheckboxField","Fragment","ArrowBox","ytelseInitialValues","ytelsePeriodeFieldName","ytelseValues","newValues","ytelsePerioderFieldName","ytelsePerioder","tv","createIntl","messages","AndreYtelserPapirsoknadIndex","RawIntlProvider","AndreYtelserPapirsoknadIndex$1"],"mappings":"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"}