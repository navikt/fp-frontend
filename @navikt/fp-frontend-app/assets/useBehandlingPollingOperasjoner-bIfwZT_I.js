var R=Object.defineProperty;var k=(t,e,s)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var E=(t,e,s)=>k(t,typeof e!="symbol"?e+"":e,s);import{u}from"./index.es-CyZRmUOO.js";import{u as L}from"./behandlingApi-3uYDn4C8.js";import{j as v}from"./jsx-runtime-D_zvdyIk.js";import{r as d}from"./index-DjhIdADd.js";import{A as m,E as f}from"./errorType-rskzfovb.js";import"./skjermlenkeCodes-1SvLTuBb.js";import{u as S}from"./RestApiErrorContext-D7YnyNzE.js";import{g as A}from"./initFetch-DDO4sht4.js";import{a as T}from"./index-CfpqQiaz.js";const D=1800,h=202;class x extends Error{constructor(s){super("MAX_POLLING");E(this,"location");this.location=s}}const i=async(t,e)=>{if(t.status===h){const s=t.headers.get("location");if(s===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await w(e,s)}catch(n){if(n instanceof T){const r=await n.response.json();if(q(r))return e(!1),await A(r.location)}throw n}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},w=async(t,e,s=0)=>{const n=await A(e);if(_(n)){if(s===D)throw t(!1),new x(e);const{pollIntervalMillis:r}=n,a=s<30?r:r+(s-30)*r;return t(!0),await O(a),await w(t,e,s+1)}return t(!1),n},_=t=>{const e=t;return e.pending!==void 0&&e.location!==void 0},q=t=>t.status===m.DELAYED||t.status===m.HALTED,O=t=>new Promise(e=>{setTimeout(e,t)}),B=t=>{const{addErrorMessage:e}=S();return{onBehandlingSuccess:n=>{var r,a;if(((r=n.taskStatus)==null?void 0:r.status)===m.HALTED){const{message:c,status:p}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p})}if(((a=n.taskStatus)==null?void 0:a.status)===m.DELAYED){const{message:c,status:p,eta:l}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p,eta:l??""})}t(n)}}},P=d.createContext(null),F=({children:t})=>{const[e,s]=d.useState(!1),n=d.useMemo(()=>({isRequestPending:e,setIsRequestPending:s}),[e,s]);return v.jsx(P.Provider,{value:n,children:t})},H=()=>{const t=d.useContext(P);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};F.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const z=(t,e)=>{const{pollingApi:s}=L(t),{onBehandlingSuccess:n}=B(e),{setIsRequestPending:r}=H(),{mutate:a}=u({mutationFn:async()=>{const o=await s.opprettVerge({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n}),{mutate:c}=u({mutationFn:async()=>{const o=await s.fjernVerge({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n}),{mutateAsync:p}=u({mutationFn:async o=>{const g=await s.lagreAksjonspunkt(o);return i(g,r)},onSuccess:n}),{mutateAsync:l}=u({mutationFn:async o=>{const g=await s.lagreOverstyrtAksjonspunkt(o);return i(g,r)},onSuccess:n}),{mutate:j}=u({mutationFn:async()=>{const o=await s.åpneBehandlingForEndring(t.uuid,t.versjon);return i(o,r)},onSuccess:n}),{mutate:y}=u({mutationFn:async()=>{const o=await s.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n});return{lagreAksjonspunkter:p,lagreOverstyrteAksjonspunkter:l,opprettVerge:a,fjernVerge:c,åpneForEndringer:j,gjenopptaBehandling:y}};export{x as P,F as R,H as a,B as b,i as d,z as u};
