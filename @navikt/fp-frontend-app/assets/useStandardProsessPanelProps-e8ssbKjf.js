import{r as y,j as P,G as M,aZ as F,b0 as I,b1 as x}from"./iframe-DZEhzxBR.js";import{V as p}from"./vilkarUtfallType-vN0hVpa7.js";import{B as A}from"./FagsakIndex-BJEpygrp.js";import{B as K,P as q}from"./BehandlingHenlagtPanel-BGSFshly.js";import{J as B,f as T}from"./index.es-DDrxbjMu.js";import{b as C,i as L}from"./index-M-KUA19r.js";import{J as E}from"./fagsakApi-CNjYg4qr.js";const N=()=>{const[s,t]=y.useState([]),n=e=>{t(i=>{const r=[...i],a=r.findIndex(o=>o.id===e.id);return a>=0?r.splice(a,1,e):r.push(e),r})};return{prosessPanelMenyData:s.filter(e=>e.skalVisesImeny),settProsessPanelMenyData:n}},U="_container_8bfic_1",V="_meny_8bfic_5",w="_stepArrowContainer_8bfic_12",h={container:U,meny:V,stepArrowContainer:w},Y=({valgtProsessSteg:s,valgtFaktaSteg:t,children:n})=>{const{oppdaterProsessStegOgFaktaPanelIUrl:e}=y.use(A),{behandling:i}=y.use(A),{prosessPanelMenyData:r,settProsessPanelMenyData:a}=N(),o=d=>{const c=r[d],u=c.erAktiv?void 0:c.id;e(u,t)},l=r.map(d=>{const c=H(d.status,d.harApentAksjonspunkt);return{label:d.tekst??"",isActive:d.erAktiv,type:c}});return P.jsxs("div",{className:h.container,children:[P.jsx("div",{className:h.meny,"data-testid":"prosess-meny",children:P.jsx(B,{steps:l,onClick:o,stepArrowContainerStyle:h.stepArrowContainer})}),P.jsx(G,{valgtProsessSteg:s,settProsessPanelMenyData:a,prosessPanelMenyData:r,children:n}),i.behandlingHenlagt&&P.jsx(K,{valgtProsessSteg:s,settProsessPanelMenyData:a})]})},O=y.createContext({}),G=s=>{const{children:t,...n}=s,e=y.useMemo(()=>n,[n]);return P.jsx(O.Provider,{value:e,children:t})},H=(s,t)=>t?T.warning:s===p.OPPFYLT?T.success:s===p.IKKE_OPPFYLT?T.danger:T.default;Y.__docgenInfo={description:"",methods:[],displayName:"ProsessMeny",props:{valgtProsessSteg:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},valgtFaktaSteg:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},children:{required:!0,tsType:{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"},description:""}}};const J=(s,t)=>s!==M.BEHANDLING_UTREDES?{}:t.reduce((n,e)=>({...n,[e.definisjon]:{notAccepted:e.toTrinnsBehandling&&e.toTrinnsBehandlingGodkjent===!1}}),{}),W=s=>{var t;return((t=s.taskStatus)==null?void 0:t.readOnly)??!1},Z=(s,t,n,e)=>{const{behandlingPåVent:i}=s,r=e||W(s),a=t.some(o=>!o.overstyrbar);return!n.writeAccess.isEnabled||i||r||a},z="default",Q=(s,t,n,e,i,r)=>{const{valgtProsessSteg:a,settProsessPanelMenyData:o}=y.use(O),l=n&&(a===s||r&&a===z);return y.useEffect(()=>{o({id:s,tekst:t,erAktiv:l,harApentAksjonspunkt:e,status:i,skalVisesImeny:n})},[n,l,e,i]),n&&l},X=s=>{const{standardPanelProps:t}=s,n=t.isAksjonspunktOpen;return P.jsx(S,{...s,harApentAksjonspunkt:n})},$=s=>{const{erOverstyrt:t}=F(),{standardPanelProps:n}=s,e=t||n.isAksjonspunktOpen;return P.jsx(S,{...s,harApentAksjonspunkt:e})},S=({overstyrtStatus:s,skalMarkeresSomAktiv:t,skalPanelVisesIMeny:n,prosessPanelKode:e,prosessPanelMenyTekst:i,standardPanelProps:r,harApentAksjonspunkt:a,children:o})=>{const{behandling:l,fagsak:d,alleKodeverk:c}=y.use(A),u=s??r.status,m=!!t&&!l.behandlingHenlagt,k=Q(e,i,n,a,u,m||a),f=k&&(a||u!==p.IKKE_VURDERT);return P.jsx(I,{behandling:l,children:P.jsx(q,{erPanelValgt:k,erAksjonspunktOpent:r.isAksjonspunktOpen,status:u,children:f?P.jsx(x,{behandling:l,fagsak:d,aksjonspunkterForPanel:r.aksjonspunkter,harÅpneAksjonspunkter:r.isAksjonspunktOpen,alleKodeverk:c,submitCallback:r.submitCallback,isReadOnly:r.isReadOnly,alleMerknaderFraBeslutter:r.alleMerknaderFraBeslutter,children:o}):null})})};X.__docgenInfo={description:"",methods:[],displayName:"ProsessDefaultInitPanel",props:{skalPanelVisesIMeny:{required:!0,tsType:{name:"boolean"},description:""},overstyrtStatus:{required:!1,tsType:{name:"string"},description:""},prosessPanelKode:{required:!0,tsType:{name:"ProsessStegCode"},description:""},prosessPanelMenyTekst:{required:!0,tsType:{name:"string"},description:""},skalMarkeresSomAktiv:{required:!1,tsType:{name:"boolean"},description:""},standardPanelProps:{required:!0,tsType:{name:"StandardProsessPanelProps"},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""}}};$.__docgenInfo={description:"",methods:[],displayName:"ProsessDefaultInitOverstyringPanel",props:{skalPanelVisesIMeny:{required:!0,tsType:{name:"boolean"},description:""},overstyrtStatus:{required:!1,tsType:{name:"string"},description:""},prosessPanelKode:{required:!0,tsType:{name:"ProsessStegCode"},description:""},prosessPanelMenyTekst:{required:!0,tsType:{name:"string"},description:""},skalMarkeresSomAktiv:{required:!1,tsType:{name:"boolean"},description:""},standardPanelProps:{required:!0,tsType:{name:"StandardProsessPanelProps"},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const ee="default",se="default",ne=(s,t,n,e,i,r)=>a=>{const o=Array.isArray(a)?a:[a],l=o.map(u=>({"@type":u.kode,...u})),d={saksnummer:t.saksnummer,behandlingUuid:n.uuid,behandlingVersjon:n.versjon},c=s(o);if(r){const u=e.filter(k=>o.some(f=>f.kode===k.definisjon)),m=u.some(k=>k.aksjonspunktType===E.OVERSTYRING||k.aksjonspunktType===E.SAKSBEHANDLEROVERSTYRING);if(o.length===0)throw Error("Det har oppstått en teknisk feil ved lagring av aksjonspunkter. Meld feilen i Porten.");if(u.length===0||m)return r({...d,overstyrteAksjonspunktDtoer:l}).then(c)}return i({...d,bekreftedeAksjonspunktDtoer:l}).then(c)},te=(s,t)=>{if(s.length>0){const n=s.map(e=>e.vilkarStatus);return n.some(e=>e===p.IKKE_VURDERT)?p.IKKE_VURDERT:n.every(e=>e===p.OPPFYLT)?p.OPPFYLT:p.IKKE_OPPFYLT}return t.length>0?t.some(n=>L(n.status))?p.IKKE_VURDERT:p.OPPFYLT:p.IKKE_VURDERT},pe=(s,t,n)=>{const{behandling:e,rettigheter:i,fagsak:r,lagreAksjonspunkter:a,lagreOverstyrteAksjonspunkter:o,alleKodeverk:l,oppdaterProsessStegOgFaktaPanelIUrl:d}=y.use(A),{aksjonspunkt:c,vilkår:u}=e,m=c&&s?c.filter(g=>s.some(j=>j===g.definisjon)):[],k=u&&t?u.filter(g=>t.some(j=>j===g.vilkarType)):[],f=Z(e,k,i,!1),D=J(e.status,m),b=m.some(g=>g.status===C.OPPRETTET&&g.kanLoses),v=te(k,m),R=!m.some(g=>g.kanLoses)||p.OPPFYLT===v,_=ne(n||(()=>()=>{d(se,ee)}),r,e,m,a,o);return{fagsak:r,behandling:e,isAksjonspunktOpen:b,aksjonspunkter:m,vilkar:k,alleKodeverk:l,alleMerknaderFraBeslutter:D,isReadOnly:f,readOnlySubmitButton:R,submitCallback:_,status:v}};export{X as P,Y as a,$ as b,O as c,Q as d,Z as e,J as g,pe as u};
