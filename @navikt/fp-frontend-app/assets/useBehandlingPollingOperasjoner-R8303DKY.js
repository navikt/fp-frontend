var S=Object.defineProperty;var R=(t,e,s)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var g=(t,e,s)=>R(t,typeof e!="symbol"?e+"":e,s);import{d as a}from"./index.es-8K0Yozcx.js";import{u as v}from"./behandlingApi-CyfZ6x7b.js";import{A as m}from"./apiPollingStatus-nT-xUZgL.js";import{r as d,j as L}from"./iframe-FnIO03g-.js";import{u as T,E as f}from"./errorType-ehNWNL8a.js";import{z as w}from"./fagsakApi-CteLWQEX.js";import{a as D}from"./index-mAYg4Rtt.js";const h=200,x=202;class _ extends Error{constructor(s){super("MAX_POLLING");g(this,"location");this.location=s}}const u=async(t,e)=>{if(t.status===x){const s=t.headers.get("location");if(s===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await A(e,s)}catch(n){if(n instanceof D){const r=await n.response.json();if(O(r))return e(!1),await w(r.location)}throw n}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},A=async(t,e,s=0)=>{const n=await w(e);if(q(n)){if(s===h)throw t(!1),new _(e);const{pollIntervalMillis:r}=n,c=s<30?r:r+(s-30)*r;return t(!0),await V(c),await A(t,e,s+1)}return t(!1),n},q=t=>{const e=t;return e.pending!==void 0&&e.location!==void 0},O=t=>t.status===m.DELAYED||t.status===m.HALTED,V=t=>new Promise(e=>{setTimeout(e,t)}),H=t=>{const{addErrorMessage:e}=T();return{onBehandlingSuccess:n=>{var r,c;if(((r=n.taskStatus)==null?void 0:r.status)===m.HALTED){const{message:i,status:p}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:i,status:p})}if(((c=n.taskStatus)==null?void 0:c.status)===m.DELAYED){const{message:i,status:p,eta:l}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:i,status:p,eta:l??""})}t(n)}}},j=d.createContext(null),F=({children:t})=>{const[e,s]=d.useState(!1),n=d.useMemo(()=>({isRequestPending:e,setIsRequestPending:s}),[e,s]);return L.jsx(j.Provider,{value:n,children:t})},B=()=>{const t=d.useContext(j);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};F.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const $=(t,e)=>{const{pollingApi:s}=v(t),{onBehandlingSuccess:n}=H(e),{setIsRequestPending:r}=B(),{mutate:c}=a({mutationFn:async()=>{const o=await s.opprettVergeV1({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return u(o,r)},onSuccess:n}),{mutate:i}=a({mutationFn:async()=>{const o=await s.fjernVergeV1({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return u(o,r)},onSuccess:n}),{mutateAsync:p}=a({mutationFn:async o=>{const E=await s.lagreAksjonspunkt(o);return u(E,r)},onSuccess:n}),{mutateAsync:l}=a({mutationFn:async o=>{const E=await s.lagreOverstyrtAksjonspunkt(o);return u(E,r)},onSuccess:n}),{mutate:P}=a({mutationFn:async()=>{const o=await s.åpneBehandlingForEndring(t.uuid,t.versjon);return u(o,r)},onSuccess:n}),{mutate:k}=a({mutationFn:async()=>{const o=await s.merkSomHaster(t.uuid,t.versjon);return u(o,r)},onSuccess:n}),{mutate:y}=a({mutationFn:async()=>{const o=await s.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return u(o,r)},onSuccess:n});return{lagreAksjonspunkter:p,lagreOverstyrteAksjonspunkter:l,opprettVergeV1:c,fjernVergeV1:i,åpneForEndringer:P,merkSomHaster:k,gjenopptaBehandling:y}};export{_ as P,F as R,B as a,H as b,u as d,$ as u};
