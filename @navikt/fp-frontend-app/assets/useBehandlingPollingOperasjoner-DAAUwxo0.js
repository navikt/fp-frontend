var R=Object.defineProperty;var k=(t,s,e)=>s in t?R(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var g=(t,s,e)=>k(t,typeof s!="symbol"?s+"":s,e);import{e as c}from"./index.es-CyVCs3Fw.js";import{u as L}from"./behandlingApi-10PurFxO.js";import{A as d}from"./apiPollingStatus-nT-xUZgL.js";import{r as l,j as y}from"./iframe-C9QwebDF.js";import{u as T,E as A}from"./errorType-D_HcHSTZ.js";import{z as f}from"./fagsakApi-DKpXaqNP.js";import{a as D}from"./index-BA7NrTki.js";const h=200,v=202;class S extends Error{constructor(e){super("MAX_POLLING");g(this,"location");this.location=e}}const p=async(t,s)=>{if(t.status===v){const e=t.headers.get("location");if(e===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await w(s,e)}catch(n){if(n instanceof D){const o=await n.response.json();if(x(o))return s(!1),await f(o.location)}throw n}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},w=async(t,s,e=0)=>{const n=await f(s);if(j(n)){if(e===h)throw t(!1),new S(s);const{pollIntervalMillis:o}=n,a=e<30?o:o+(e-30)*o;return t(!0),await _(a),await w(t,s,e+1)}return t(!1),n},j=t=>{const s=t;return s.pending!==void 0&&s.location!==void 0},x=t=>t.status===d.DELAYED||t.status===d.HALTED,_=t=>new Promise(s=>{setTimeout(s,t)}),q=t=>{const{addErrorMessage:s}=T();return{onBehandlingSuccess:n=>{var o,a;if(((o=n.taskStatus)==null?void 0:o.status)===d.HALTED){const{message:i,status:u}=n.taskStatus;s({type:A.POLLING_HALTED_OR_DELAYED,message:i,status:u})}if(((a=n.taskStatus)==null?void 0:a.status)===d.DELAYED){const{message:i,status:u,eta:m}=n.taskStatus;s({type:A.POLLING_HALTED_OR_DELAYED,message:i,status:u,eta:m??""})}t(n)}}},P=l.createContext(null),O=({children:t})=>{const[s,e]=l.useState(!1),n=l.useMemo(()=>({isRequestPending:s,setIsRequestPending:e}),[s,e]);return y.jsx(P.Provider,{value:n,children:t})},B=()=>{const t=l.useContext(P);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};O.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const U=(t,s)=>{const{pollingApi:e}=L(t),{onBehandlingSuccess:n}=q(s),{setIsRequestPending:o}=B(),{mutateAsync:a}=c({mutationFn:async r=>{const E=await e.lagreAksjonspunkt(r);return p(E,o)},onSuccess:n}),{mutateAsync:i}=c({mutationFn:async r=>{const E=await e.lagreOverstyrtAksjonspunkt(r);return p(E,o)},onSuccess:n}),{mutate:u}=c({mutationFn:async()=>{const r=await e.åpneBehandlingForEndring(t.uuid,t.versjon);return p(r,o)},onSuccess:n}),{mutate:m}=c({mutationFn:async()=>{const r=await e.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return p(r,o)},onSuccess:n});return{lagreAksjonspunkter:a,lagreOverstyrteAksjonspunkter:i,åpneForEndringer:u,gjenopptaBehandling:m}};export{S as P,O as R,B as a,q as b,p as d,U as u};
