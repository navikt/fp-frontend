import{j as k}from"./jsx-runtime-D_zvdyIk.js";import{r as y}from"./index-DjhIdADd.js";import{d as M,K as I,G as K,I as F}from"./withPanelData-DrXorGTR.js";import{B as x,V as p,P as L}from"./BehandlingHenlagtPanel-BPDENgkb.js";import"./skjermlenkeCodes-1SvLTuBb.js";import{B as A}from"./FagsakIndex-Dt8-rmNB.js";import{y as N,q as T}from"./index.es-X9si7bys.js";import{A as q,i as U}from"./aksjonspunktStatus-xM4O_ZUY.js";var E=(e=>(e.MANUELL="MANU",e.AUTOPUNKT="AUTO",e.OVERSTYRING="OVST",e.SAKSBEHANDLEROVERSTYRING="SAOV",e))(E||{});const B=()=>{const[e,t]=y.useState([]),n=s=>{t(i=>{const r=[...i],a=r.findIndex(o=>o.id===s.id);return a>=0?r.splice(a,1,s):r.push(s),r})};return{prosessPanelMenyData:e.filter(s=>s.skalVisesImeny),settProsessPanelMenyData:n}},V="_container_8bfic_1",C="_meny_8bfic_5",w="_stepArrowContainer_8bfic_12",h={container:V,meny:C,stepArrowContainer:w},Y=({valgtProsessSteg:e,valgtFaktaSteg:t,children:n})=>{const{oppdaterProsessStegOgFaktaPanelIUrl:s}=y.use(A),{behandling:i}=y.use(A),{prosessPanelMenyData:r,settProsessPanelMenyData:a}=B(),o=u=>{const c=r[u],d=c.erAktiv?void 0:c.id;s(d,t)},l=r.map(u=>{const c=H(u.status,u.harApentAksjonspunkt);return{label:u.tekst??"",isActive:u.erAktiv,type:c}});return k.jsxs("div",{className:h.container,children:[k.jsx("div",{className:h.meny,children:k.jsx(N,{steps:l,onClick:o,stepArrowContainerStyle:h.stepArrowContainer})}),k.jsx(G,{valgtProsessSteg:e,settProsessPanelMenyData:a,prosessPanelMenyData:r,children:n}),i.behandlingHenlagt&&k.jsx(x,{valgtProsessSteg:e,settProsessPanelMenyData:a})]})},v=y.createContext({}),G=e=>{const{children:t,...n}=e,s=y.useMemo(()=>n,[n]);return k.jsx(v.Provider,{value:s,children:t})},H=(e,t)=>t?T.warning:e===p.OPPFYLT?T.success:e===p.IKKE_OPPFYLT?T.danger:T.default;Y.__docgenInfo={description:"",methods:[],displayName:"ProsessMeny",props:{valgtProsessSteg:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},valgtFaktaSteg:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},children:{required:!0,tsType:{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"},description:""}}};const W=(e,t)=>e.status!==M.BEHANDLING_UTREDES?{}:t.reduce((n,s)=>({...n,[s.definisjon]:{notAccepted:s.toTrinnsBehandling&&s.toTrinnsBehandlingGodkjent===!1}}),{}),z=e=>{var t;return((t=e.taskStatus)==null?void 0:t.readOnly)??!1},J=(e,t,n,s)=>{const{behandlingPaaVent:i}=e,r=s||z(e),a=t.some(o=>!o.overstyrbar);return!n.writeAccess.isEnabled||i||r||a},Q="default",X=(e,t,n,s,i,r)=>{const{valgtProsessSteg:a,settProsessPanelMenyData:o}=y.use(v),l=n&&(a===e||r&&a===Q);return y.useEffect(()=>{o({id:e,tekst:t,erAktiv:l,harApentAksjonspunkt:s,status:i,skalVisesImeny:n})},[n,l,s,i]),n&&l},Z=e=>{const{standardPanelProps:t}=e,n=t.isAksjonspunktOpen;return k.jsx(j,{...e,harApentAksjonspunkt:n})},$=e=>{const{erOverstyrt:t}=I(),{standardPanelProps:n}=e,s=t||n.isAksjonspunktOpen;return k.jsx(j,{...e,harApentAksjonspunkt:s})},j=({hentOverstyrtStatus:e,hentSkalMarkeresSomAktiv:t,skalPanelVisesIMeny:n,prosessPanelKode:s,prosessPanelMenyTekst:i,standardPanelProps:r,harApentAksjonspunkt:a,children:o})=>{const{behandling:l,fagsak:u,alleKodeverk:c}=y.use(A),d=e??r.status,m=!!t&&!l.behandlingHenlagt,P=X(s,i,n,a,d,m||a),f=P&&(a||d!==p.IKKE_VURDERT);return k.jsx(K,{behandling:l,children:k.jsx(L,{erPanelValgt:P,erAksjonspunktOpent:r.isAksjonspunktOpen,status:d,children:f?k.jsx(F,{behandling:l,fagsak:u,aksjonspunkterForPanel:r.aksjonspunkter,harÅpneAksjonspunkter:r.isAksjonspunktOpen,alleKodeverk:c,submitCallback:r.submitCallback,isReadOnly:r.isReadOnly,alleMerknaderFraBeslutter:r.alleMerknaderFraBeslutter,children:o}):null})})};Z.__docgenInfo={description:"",methods:[],displayName:"ProsessDefaultInitPanel",props:{skalPanelVisesIMeny:{required:!0,tsType:{name:"boolean"},description:""},hentOverstyrtStatus:{required:!1,tsType:{name:"string"},description:""},prosessPanelKode:{required:!0,tsType:{name:"ProsessStegCode"},description:""},prosessPanelMenyTekst:{required:!0,tsType:{name:"string"},description:""},hentSkalMarkeresSomAktiv:{required:!1,tsType:{name:"boolean"},description:""},standardPanelProps:{required:!0,tsType:{name:"StandardProsessPanelProps"},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""}}};$.__docgenInfo={description:"",methods:[],displayName:"ProsessDefaultInitOverstyringPanel",props:{skalPanelVisesIMeny:{required:!0,tsType:{name:"boolean"},description:""},hentOverstyrtStatus:{required:!1,tsType:{name:"string"},description:""},prosessPanelKode:{required:!0,tsType:{name:"ProsessStegCode"},description:""},prosessPanelMenyTekst:{required:!0,tsType:{name:"string"},description:""},hentSkalMarkeresSomAktiv:{required:!1,tsType:{name:"boolean"},description:""},standardPanelProps:{required:!0,tsType:{name:"StandardProsessPanelProps"},description:""},children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const ee="default",se="default",ne=(e,t,n,s,i,r)=>a=>{const o=Array.isArray(a)?a:[a],l=o.map(d=>({"@type":d.kode,...d})),u={saksnummer:t.saksnummer,behandlingUuid:n.uuid,behandlingVersjon:n.versjon},c=e(o);if(r){const d=s.filter(P=>o.some(f=>f.kode===P.definisjon)),m=d.some(P=>P.aksjonspunktType===E.OVERSTYRING||P.aksjonspunktType===E.SAKSBEHANDLEROVERSTYRING);if(o.length===0)throw Error("Det har oppstått en teknisk feil ved lagring av aksjonspunkter. Meld feilen i Porten.");if(d.length===0||m)return r({...u,overstyrteAksjonspunktDtoer:l}).then(c)}return i({...u,bekreftedeAksjonspunktDtoer:l}).then(c)},te=(e,t)=>{if(e.length>0){const n=e.map(s=>s.vilkarStatus);return n.some(s=>s===p.IKKE_VURDERT)?p.IKKE_VURDERT:n.every(s=>s===p.OPPFYLT)?p.OPPFYLT:p.IKKE_OPPFYLT}return t.length>0?t.some(n=>U(n.status))?p.IKKE_VURDERT:p.OPPFYLT:p.IKKE_VURDERT},Pe=(e,t,n)=>{const{behandling:s,rettigheter:i,fagsak:r,lagreAksjonspunkter:a,lagreOverstyrteAksjonspunkter:o,alleKodeverk:l,oppdaterProsessStegOgFaktaPanelIUrl:u}=y.use(A),{aksjonspunkt:c,vilkår:d}=s,m=c&&e?c.filter(g=>e.some(O=>O===g.definisjon)):[],P=d&&t?d.filter(g=>t.some(O=>O===g.vilkarType)):[],f=J(s,P,i,!1),R=W(s,m),D=m.some(g=>g.status===q.OPPRETTET&&g.kanLoses),S=te(P,m),_=!m.some(g=>g.kanLoses)||p.OPPFYLT===S,b=ne(n||(()=>()=>{u(se,ee)}),r,s,m,a,o);return{fagsak:r,behandling:s,isAksjonspunktOpen:D,aksjonspunkter:m,vilkar:P,alleKodeverk:l,alleMerknaderFraBeslutter:R,isReadOnly:f,readOnlySubmitButton:_,submitCallback:b,status:S}};export{Z as P,Y as a,$ as b,v as c,X as d,J as e,W as g,Pe as u};
