var R=Object.defineProperty;var k=(t,e,s)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var g=(t,e,s)=>k(t,typeof e!="symbol"?e+"":e,s);import{d as u}from"./index.es-Ic8-cdME.js";import{u as L}from"./behandlingApi-tLFfC7cE.js";import{A as d}from"./apiPollingStatus-nT-xUZgL.js";import{r as m,j as v}from"./iframe-DyNQ8pxm.js";import{u as S,E as f}from"./errorType-BLUN7xUo.js";import{z as A}from"./fagsakApi-DYk9oBgu.js";import{a as T}from"./index-BXqKkPSv.js";const D=200,h=202;class x extends Error{constructor(s){super("MAX_POLLING");g(this,"location");this.location=s}}const i=async(t,e)=>{if(t.status===h){const s=t.headers.get("location");if(s===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await w(e,s)}catch(n){if(n instanceof T){const r=await n.response.json();if(q(r))return e(!1),await A(r.location)}throw n}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},w=async(t,e,s=0)=>{const n=await A(e);if(_(n)){if(s===D)throw t(!1),new x(e);const{pollIntervalMillis:r}=n,a=s<30?r:r+(s-30)*r;return t(!0),await O(a),await w(t,e,s+1)}return t(!1),n},_=t=>{const e=t;return e.pending!==void 0&&e.location!==void 0},q=t=>t.status===d.DELAYED||t.status===d.HALTED,O=t=>new Promise(e=>{setTimeout(e,t)}),V=t=>{const{addErrorMessage:e}=S();return{onBehandlingSuccess:n=>{var r,a;if(((r=n.taskStatus)==null?void 0:r.status)===d.HALTED){const{message:c,status:p}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p})}if(((a=n.taskStatus)==null?void 0:a.status)===d.DELAYED){const{message:c,status:p,eta:l}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p,eta:l??""})}t(n)}}},P=m.createContext(null),B=({children:t})=>{const[e,s]=m.useState(!1),n=m.useMemo(()=>({isRequestPending:e,setIsRequestPending:s}),[e,s]);return v.jsx(P.Provider,{value:n,children:t})},F=()=>{const t=m.useContext(P);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};B.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const X=(t,e)=>{const{pollingApi:s}=L(t),{onBehandlingSuccess:n}=V(e),{setIsRequestPending:r}=F(),{mutate:a}=u({mutationFn:async()=>{const o=await s.opprettVergeV1({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n}),{mutate:c}=u({mutationFn:async()=>{const o=await s.fjernVergeV1({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n}),{mutateAsync:p}=u({mutationFn:async o=>{const E=await s.lagreAksjonspunkt(o);return i(E,r)},onSuccess:n}),{mutateAsync:l}=u({mutationFn:async o=>{const E=await s.lagreOverstyrtAksjonspunkt(o);return i(E,r)},onSuccess:n}),{mutate:j}=u({mutationFn:async()=>{const o=await s.åpneBehandlingForEndring(t.uuid,t.versjon);return i(o,r)},onSuccess:n}),{mutate:y}=u({mutationFn:async()=>{const o=await s.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(o,r)},onSuccess:n});return{lagreAksjonspunkter:p,lagreOverstyrteAksjonspunkter:l,opprettVergeV1:a,fjernVergeV1:c,åpneForEndringer:j,gjenopptaBehandling:y}};export{x as P,B as R,F as a,V as b,i as d,X as u};
