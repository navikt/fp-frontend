var y=Object.defineProperty;var C=(t,s,e)=>s in t?y(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var E=(t,s,e)=>C(t,typeof s!="symbol"?s+"":s,e);import{j as f}from"./jsx-runtime-DR9Q75dM.js";import{r as l,g as w}from"./index-DRjF_FHU.js";var T=(t=>(t.NOT_STARTED="NOT_STARTED",t.LOADING="LOADING",t.SUCCESS="SUCCESS",t.ERROR="ERROR",t))(T||{});const O={},G=l.createContext(O),x=l.createContext(void 0),F=({children:t,initialState:s})=>{const[e,i]=l.useReducer((n,a)=>{switch(a.type){case"success":return{...n,[a.key]:a.data};case"remove":return Object.keys(n).filter(o=>o!==a.key).reduce((o,r)=>({...o,[r]:n[r]}),{});default:throw new Error}},s||O);return f.jsx(G.Provider,{value:e,children:f.jsx(x.Provider,{value:i,children:t})})};F.__docgenInfo={description:`HÃ¥ndterer state for data som skal hentes fra backend kun en gang og som en trenger aksess til
mange steder i applikasjonen.`,methods:[],displayName:"RestApiProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},initialState:{required:!1,tsType:{name:"signature",type:"object",raw:"{ [key in string]: any }",signature:{properties:[{key:{name:"string",required:!0},value:{name:"any"}}]}},description:""}}};const A={errors:[]},Q=l.createContext(A),b=l.createContext(void 0),M=({children:t,initialState:s})=>{const[e,i]=l.useReducer((n,a)=>{switch(a.type){case"add":return{errors:n.errors.concat(a.data)};case"remove":return A;default:throw new Error}},s||A);return f.jsx(Q.Provider,{value:e,children:f.jsx(b.Provider,{value:i,children:t})})};M.__docgenInfo={description:"Tilbyr kontekst for lagring av feilmeldinger.",methods:[],displayName:"RestApiErrorProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},initialState:{required:!1,tsType:{name:"signature",type:"object",raw:"{ errors: any[] }",signature:{properties:[{key:"errors",value:{name:"Array",elements:[{name:"any"}],raw:"any[]",required:!0}}]}},description:""}}};const q=(t,s)=>!(t.length===s.length&&t.every((e,i)=>e===s[i])),H=t=>t.toLowerCase().replace(/_([a-z])/g,s=>s.toUpperCase()).replace(/_/g,""),m={updateTriggers:[],keepData:!1,suspendRequest:!1,isCachingOn:!1},_={state:T.NOT_STARTED,error:void 0,data:void 0},at=t=>function(e,i=m){const[n,a]=l.useState(_),o={...m,...i},r=l.useRef();l.useEffect(()=>{r.current=o.updateTriggers},[i.updateTriggers]);const d=r.current;return l.useEffect(()=>{if(o.suspendRequest)a(_);else{a(R=>({state:T.LOADING,error:void 0,data:o.keepData?R.data:void 0}));const u=e.filter(R=>t.hasPath(R.key.name));Promise.all(u.map(R=>t.startRequest(R.key.name,R.params,i.isCachingOn))).then(R=>{a({state:T.SUCCESS,data:R.reduce((I,P,v)=>({...I,[H(u[v].key.name)]:P.payload}),{}),error:void 0})}).catch(R=>{a({state:T.ERROR,data:void 0,error:R})})}},[...o.updateTriggers]),d&&q(d,o.updateTriggers)?{..._,data:i.keepData?n.data:void 0}:n};var c=(t=>(t.POLLING_HALTED_OR_DELAYED="POLLING_HALTED_OR_DELAYED",t.POLLING_TIMEOUT="POLLING_TIMEOUT",t.REQUEST_ERROR="REQUEST_ERROR",t.REQUEST_FINISHED="REQUEST_FINISHED",t.REQUEST_FORBIDDEN="REQUEST_FORBIDDEN",t.REQUEST_STARTED="REQUEST_STARTED",t.REQUEST_UNAUTHORIZED="REQUEST_UNAUTHORIZED",t.STATUS_REQUEST_FINISHED="STATUS_REQUEST_FINISHED",t.STATUS_REQUEST_STARTED="STATUS_REQUEST_STARTED",t.UPDATE_POLLING_MESSAGE="UPDATE_POLLING_MESSAGE",t.REQUEST_GATEWAY_TIMEOUT_OR_NOT_FOUND="REQUEST_GATEWAY_TIMEOUT_OR_NOT_FOUND",t))(c||{}),h=(t=>(t.PENDING="PENDING",t.COMPLETE="COMPLETE",t.DELAYED="DELAYED",t.CANCELLED="CANCELLED",t.HALTED="HALTED",t))(h||{}),k=(t=>(t.MANGLER_TILGANG_FEIL="MANGLER_TILGANG_FEIL",t.TOMT_RESULTAT_FEIL="TOMT_RESULTAT_FEIL",t.BEHANDLING_ENDRET_FEIL="BEHANDLING_ENDRET_FEIL",t.GENERELL_FEIL="GENERELL_FEIL",t))(k||{});const j=["MANGLER_TILGANG_FEIL"],Y=t=>{var s;return((s=t==null?void 0:t.response)==null?void 0:s.data)??t},it=(t,s)=>!!s&&Y(s).type===t,B=t=>!!t&&j.some(s=>s===t);class N extends Error{constructor(e){super("Maximum polling attempts exceeded");E(this,"location");this.location=e}}const D=t=>typeof t=="string",$=t=>{var s;return t&&((s=t.config)==null?void 0:s.responseType)==="blob"},z=t=>{const s=new FileReader;return new Promise((e,i)=>{s.onerror=()=>{s.abort(),i(new Error("Problem parsing blob"))},s.onload=()=>{s.result&&!(s.result instanceof ArrayBuffer)?e(s.result):i(new Error("Problem parsing blob"))},t instanceof Blob&&s.readAsText(t)})};class W{constructor(s,e){E(this,"notify");E(this,"isPollingRequest");E(this,"handleError",async s=>{if(s instanceof N){this.notify(c.POLLING_TIMEOUT,{location:s.location});return}const e=this.formatError(s);if($(s)){const i=await z(e.data);D(i)&&(e.data=JSON.parse(i))}e.isGatewayTimeoutOrNotFound?this.notify(c.REQUEST_GATEWAY_TIMEOUT_OR_NOT_FOUND,{location:e.location},this.isPollingRequest):e.isUnauthorized?this.notify(c.REQUEST_UNAUTHORIZED,{message:s.message},this.isPollingRequest):e.isForbidden?this.notify(c.REQUEST_FORBIDDEN,e.data?e.data:{message:s.message}):e.is418?this.notify(c.POLLING_HALTED_OR_DELAYED,e.data):!s.response&&s.message?this.notify(c.REQUEST_ERROR,{message:s.message},this.isPollingRequest):B(e.type)||this.notify(c.REQUEST_ERROR,this.getFormattedData(e.data),this.isPollingRequest)});E(this,"getFormattedData",s=>D(s)?{message:s}:s);E(this,"findErrorData",s=>s.data?s.data:s.statusText);E(this,"formatError",s=>{const e=s&&s.response?s.response:void 0;return{data:e?this.findErrorData(e):void 0,type:e&&e.data?e.data.type:void 0,status:e?e.status:void 0,isForbidden:e?e.status===403:void 0,isUnauthorized:e?e.status===401:void 0,is418:e?e.status===418:void 0,isGatewayTimeoutOrNotFound:e?e.status===504||e.status===404:void 0,location:e&&e.config?e.config.url:void 0}});this.notify=s,this.isPollingRequest=e}}const Z=202,J=50,p="INTERNAL_CANCELLATION",V=t=>new Promise(s=>{setTimeout(s,t)}),X=t=>!!(t!=null&&t.location)&&(t.status===h.DELAYED||t.status===h.HALTED);class nt{constructor(s,e,i,n){E(this,"httpClientApi");E(this,"restMethod");E(this,"path");E(this,"config");E(this,"maxPollingLimit",J);E(this,"notify",()=>{});E(this,"isCancelled",!1);E(this,"isPollingRequest",!1);E(this,"setNotificationEmitter",s=>{this.notify=s});E(this,"execLongPolling",async(s,e=0,i=0)=>{if(i===this.maxPollingLimit)throw this.notify(c.REQUEST_FINISHED),new N(s||"No location");const n=i<30?e:e+(i-30)*e;if(await V(n),!s||this.isCancelled)return null;this.notify(c.STATUS_REQUEST_STARTED);const a=await this.httpClientApi.get(s);if(this.notify(c.STATUS_REQUEST_FINISHED),!("data"in a))return a;const o=a.data;if(o&&o.status===h.PENDING){const{pollIntervalMillis:r,message:d}=o;return this.notify(c.UPDATE_POLLING_MESSAGE,d),this.execLongPolling(s,r,i+1)}return a});E(this,"execute",async(s,e,i)=>{let n=await e(s,i);if("status"in n&&n.status===Z){this.isPollingRequest=!0;try{return await this.execLongPolling(n.headers.location)}catch(a){const o=a.response?a.response.data:void 0;if(X(o))n=await this.httpClientApi.get(o.location),"data"in n&&this.notify(c.POLLING_HALTED_OR_DELAYED,n.data.taskStatus);else throw a}}return n});E(this,"cancel",()=>{this.isCancelled=!0});E(this,"start",async s=>{this.notify(c.REQUEST_STARTED);try{const e=await this.execute(this.path,this.restMethod,s);if(this.isCancelled)throw new Error(p);const i=e!==null&&"data"in e?e.data:void 0;return this.notify(c.REQUEST_FINISHED,i,this.isPollingRequest),i?{payload:i}:{payload:void 0}}catch(e){const{response:i}=e;if(i&&i.status===401&&i.headers&&i.headers.location){const n=encodeURIComponent(window.location.pathname+window.location.search);window.location.href=`${i.headers.location}?redirectTo=${n}`}throw(e==null?void 0:e.message)!==p&&new W(this.notify,this.isPollingRequest).handleError(e),e}});this.httpClientApi=s,this.restMethod=e,this.path=i,this.config=n,this.maxPollingLimit=n.maxPollingLimit||this.maxPollingLimit}}const g={updateTriggers:[],keepData:!1,suspendRequest:!1,isCachingOn:!1},S={state:T.NOT_STARTED,error:void 0,data:void 0},ot=t=>function(e,i,n=g){const a={...g,...n},[o,r]=l.useState(S);return l.useEffect(()=>{t.hasPath(e.name)&&!a.suspendRequest?(r(d=>({state:T.LOADING,error:void 0,data:a.keepData?d.data:void 0})),t.startRequest(e.name,i,n.isCachingOn).then(d=>{r({state:T.SUCCESS,data:d.payload,error:void 0})}).catch(d=>{(d==null?void 0:d.message)!==p&&r({state:T.ERROR,data:void 0,error:d})})):t.hasPath(e.name)||r(S)},[...a.updateTriggers]),!t.hasPath(e.name)&&a.suspendRequest?S:o},L={state:T.NOT_STARTED,error:void 0,data:void 0},rt=t=>function(e){const[i,n]=l.useState(L),a=l.useCallback((r,d=!1)=>t.hasPath(e.name)?(n(u=>({state:T.LOADING,data:d?u.data:void 0,error:void 0})),t.startRequest(e.name,r).then(u=>(n({state:T.SUCCESS,data:u.payload,error:void 0}),Promise.resolve(u.payload))).catch(u=>{if((u==null?void 0:u.message)!==p)throw n({state:T.ERROR,data:void 0,error:u}),u})):(n(L),Promise.resolve(void 0)),[]),o=l.useCallback(()=>{n(L)},[]);return{startRequest:a,resetRequestData:o,...i}};var U={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var s={}.hasOwnProperty;function e(){for(var a="",o=0;o<arguments.length;o++){var r=arguments[o];r&&(a=n(a,i.call(this,r)))}return a}function i(a){if(typeof a=="string"||typeof a=="number")return this&&this[a]||a;if(typeof a!="object")return"";if(Array.isArray(a))return e.apply(this,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var r in a)s.call(a,r)&&a[r]&&(o=n(o,this&&this[r]||r));return o}function n(a,o){return o?a?a+" "+o:a+o:a}t.exports?(e.default=e,t.exports=e):window.classNames=e})()})(U);var K=U.exports;const Et=w(K);export{h as A,c as E,T as R,Q as a,b,Et as c,x as d,G as e,nt as f,ot as g,at as h,rt as i,it as j,k,Y as l,F as m,M as n};
