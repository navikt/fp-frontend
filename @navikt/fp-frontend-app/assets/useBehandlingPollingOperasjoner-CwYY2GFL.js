var y=Object.defineProperty;var k=(t,e,s)=>e in t?y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var E=(t,e,s)=>k(t,typeof e!="symbol"?e+"":e,s);import{u}from"./index.es-D807ybPP.js";import{u as L}from"./behandlingApi-v-44y4EH.js";import{j as S}from"./jsx-runtime-CLpGMVip.js";import{r as d}from"./index-B5OHeJSP.js";import{A as l,E as f}from"./errorType-DvWwZWq3.js";import"./skjermlenkeCodes-1SvLTuBb.js";import{u as T}from"./RestApiErrorContext-CYa6iUCd.js";import{g as A}from"./initFetch-CULiu9VR.js";import{a as D}from"./index-DqeTBbD1.js";const h=1800,v=202;class x extends Error{constructor(s){super("MAX_POLLING");E(this,"location");this.location=s}}const i=async(t,e)=>{if(t.status===v){const s=t.headers.get("location");if(s===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await w(e,s)}catch(n){if(n instanceof D){const o=await n.response.json();if(q(o))return e(!1),await A(o.location)}throw n}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},w=async(t,e,s=0)=>{const n=await A(e);if(_(n)){if(s===h)throw t(!1),new x(e);const{pollIntervalMillis:o}=n,a=s<30?o:o+(s-30)*o;return t(!0),await O(a),await w(t,e,s+1)}return t(!1),n},_=t=>{const e=t;return e.pending!==void 0&&e.location!==void 0},q=t=>t.status===l.DELAYED||t.status===l.HALTED,O=t=>new Promise(e=>{setTimeout(e,t)}),B=t=>{const{addErrorMessage:e}=T();return{onBehandlingSuccess:n=>{var o,a;if(((o=n.taskStatus)==null?void 0:o.status)===l.HALTED){const{message:c,status:p}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p})}if(((a=n.taskStatus)==null?void 0:a.status)===l.DELAYED){const{message:c,status:p,eta:m}=n.taskStatus;e({type:f.POLLING_HALTED_OR_DELAYED,message:c,status:p,eta:m??""})}t(n)}}},R=d.createContext(null),F=({children:t})=>{const[e,s]=d.useState(!1),n=d.useMemo(()=>({isRequestPending:e,setIsRequestPending:s}),[e,s]);return S.jsx(R.Provider,{value:n,children:t})},H=()=>{const t=d.useContext(R);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};F.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const z=(t,e)=>{const{pollingApi:s}=L(t),{onBehandlingSuccess:n}=B(e),{setIsRequestPending:o}=H(),{mutate:a}=u({mutationFn:async()=>{const r=await s.opprettVerge({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(r,o)},onSuccess:n}),{mutate:c}=u({mutationFn:async()=>{const r=await s.fjernVerge({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(r,o)},onSuccess:n}),{mutateAsync:p}=u({mutationFn:async r=>{const g=await s.lagreAksjonspunkt(r);return i(g,o)},onSuccess:n}),{mutateAsync:m}=u({mutationFn:async r=>{const g=await s.lagreOverstyrtAksjonspunkt(r);return i(g,o)},onSuccess:n}),{mutate:P}=u({mutationFn:async()=>{const r=await s.åpneBehandlingForEndring(t.uuid,t.versjon);return i(r,o)},onSuccess:n}),{mutate:j}=u({mutationFn:async()=>{const r=await s.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return i(r,o)},onSuccess:n});return{lagreAksjonspunkter:p,lagreOverstyrteAksjonspunkter:m,opprettVerge:a,fjernVerge:c,åpneForEndringer:P,gjenopptaBehandling:j}};export{x as P,F as R,H as a,B as b,i as d,z as u};
