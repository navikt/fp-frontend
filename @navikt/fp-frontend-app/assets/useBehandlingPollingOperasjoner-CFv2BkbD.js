import{c as i}from"./index.es-DbIGfkvq.js";import{u as P}from"./behandlingApi-eFtFbpWr.js";import{A as c}from"./apiPollingStatus-nT-xUZgL.js";import{r as p,j as R}from"./iframe-DDFjsWEF.js";import{u as k,E as m}from"./errorType-DsY5KXMi.js";import{z as E}from"./fagsakApi-C7iVUxxd.js";import{a as L}from"./index-BsDgGArn.js";const y=200,T=202;class D extends Error{location;constructor(s){super("MAX_POLLING"),this.location=s}}const u=async(t,s)=>{if(t.status===T){const n=t.headers.get("location");if(n===null)throw new Error(`Location i response er ikke angitt for URL: ${t.url}`);try{return await g(s,n)}catch(e){if(e instanceof L){const o=await e.response.json();if(v(o))return s(!1),await E(o.location)}throw e}}throw new Error(`Responderte ikke med 202 - Accepted: ${t.url}`)},g=async(t,s,n=0)=>{const e=await E(s);if(h(e)){if(n===y)throw t(!1),new D(s);const{pollIntervalMillis:o}=e,r=n<30?o:o+(n-30)*o;return t(!0),await S(r),await g(t,s,n+1)}return t(!1),e},h=t=>{const s=t;return s.pending!==void 0&&s.location!==void 0},v=t=>t.status===c.DELAYED||t.status===c.HALTED,S=t=>new Promise(s=>{setTimeout(s,t)}),j=t=>{const{addErrorMessage:s}=k();return{onBehandlingSuccess:e=>{if(e.taskStatus?.status===c.HALTED){const{message:o,status:r}=e.taskStatus;s({type:m.POLLING_HALTED_OR_DELAYED,message:o,status:r})}if(e.taskStatus?.status===c.DELAYED){const{message:o,status:r,eta:d}=e.taskStatus;s({type:m.POLLING_HALTED_OR_DELAYED,message:o,status:r,eta:d??""})}t(e)}}},A=p.createContext(null),x=({children:t})=>{const[s,n]=p.useState(!1),e=p.useMemo(()=>({isRequestPending:s,setIsRequestPending:n}),[s,n]);return R.jsx(A.Provider,{value:e,children:t})},_=()=>{const t=p.useContext(A);if(!t)throw new Error("useRequestPendingContext er avhengig av RequestPendingContext.Provider");return t};x.__docgenInfo={description:"",methods:[],displayName:"RequestPendingProvider",props:{children:{required:!0,tsType:{name:"ReactElement"},description:""}}};const F=(t,s)=>{const{pollingApi:n}=P(t),{onBehandlingSuccess:e}=j(s),{setIsRequestPending:o}=_(),{mutateAsync:r}=i({mutationFn:async a=>{const l=await n.lagreAksjonspunkt(a);return u(l,o)},onSuccess:e}),{mutateAsync:d}=i({mutationFn:async a=>{const l=await n.lagreOverstyrtAksjonspunkt(a);return u(l,o)},onSuccess:e}),{mutate:f}=i({mutationFn:async()=>{const a=await n.åpneBehandlingForEndring(t.uuid,t.versjon);return u(a,o)},onSuccess:e}),{mutate:w}=i({mutationFn:async()=>{const a=await n.gjenopptaBehandling({behandlingUuid:t.uuid,behandlingVersjon:t.versjon});return u(a,o)},onSuccess:e});return{lagreAksjonspunkter:r,lagreOverstyrteAksjonspunkter:d,åpneForEndringer:f,gjenopptaBehandling:w}};export{D as P,x as R,_ as a,j as b,u as d,F as u};
